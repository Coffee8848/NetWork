## 链路层：

下面简答或者选择:

TDMA/CDMA 信道划分协议 分时分码      CSMA

CRC 检测或校验数据传输或者保存后可能出现的错误 (大概了解)

链路层错误检验方法，错误纠正机制，实现方法
ARP作用、工作原理、工作过程、何时用 MAC地址
LAN , VLAN概念、目的、优点.

以太网.交换机.路由器和交换机什么时候用谁

MPLS指导数据报文和高速转发   --简单了解

# 链路层 本章似乎只出选择题

## 6.1  Link Layer 概览与核心服务

（对应 *Chapter 6 The Link Layer and LANs* 6.1 部分）

---

### 1  链路层在协议栈中的定位

* **位置**：位于网络层之下、物理层之上。
* **视角**：它只关心“一跳”——把 IP 数据报在相邻节点之间安全搬运；跨多跳端到端的事交给网络层。
* **实现**：几乎都在 **网卡/NIC** 芯片里完成（硬件 + 固件），所以延迟可做到微秒级。

---

### 2  链路层要解决的五件事


| 服务                 | 通俗理解                 | 典型场景                          |
| -------------------- | ------------------------ | --------------------------------- |
| **封装 Frame**       | 给上层数据“装箱贴标签” | 以太网帧包住 IP 数据报            |
| **介质接入**         | 在共享信道时协调谁先说话 | 旧式总线以太网、无线 LAN          |
| **可靠传输（可选）** | 在一跳内重传、确认       | PPP、HDLC                         |
| **差错检测/纠正**    | 在箱子外贴校验码         | CRC、Parity（将在 6.2 详解）      |
| **流量控制**         | 防止快端淹没慢端         | 以太网 PAUSE 帧、Wireless RTS/CTS |

> 注：考试清单中的 CRC、错误检验与 CSMA/TDMA 等属于后续小节 6.2–6.3 的重点，这里只是总览，不打 \*。

> half-duplex and full-duplex  with half duplex, nodes at both ends of link can transmit, but not at same time

### 3  “适配器”如何发送/接收帧

**发送端**

1. 从操作系统获得 IP 数据报 + 目的 **MAC 地址**；
2. 将其放入 NIC 的发送缓冲；
3. 加首部尾部（前导码、起始定界、CRC 等）；
4. 按所用链路协议的接入规则把比特串送上物理媒介。

**接收端**

1. 物理层恢复比特流；
2. 按帧格式提取首部，校验 CRC；
3. 若通过则把负载递交网络层；否则丢弃并可能请求重传（取决于协议）。

---

### 4  链路类型速览（为后续章节埋下概念）


| 分类             | 示例                          | 特征                     |
| ---------------- | ----------------------------- | ------------------------ |
| **点到点 (P2P)** | PPP、HDLC、点对点光纤         | 无争用，简单             |
| **广播**         | 传统 Coax Ethernet、Wi-Fi     | 需多路访问协议 (6.3)     |
| **有线 vs 无线** | 以太网、DOCSIS ↔ 802.11、LTE | 误码率、介质接入方式不同 |
| **局域 vs 广域** | LAN、VLAN ↔ MPLS 虚电路      | 范围/规划方式差异        |

---

### 5  本节小结

* 链路层负责“一跳之内”的封装、接入、可靠/差错与流控。
* 其所有功能最终体现在 **帧格式** + **接入算法** + **NIC 硬件** 中。
* 接下来的小节将逐一深入：
  * 6.2 差错检测与 \*CRC\* 等考点；
  * 6.3 \*CSMA\*、\*TDMA/CDMA\* 等多路访问；
  * 6.4 \*ARP/MAC\*、\*LAN & VLAN\*、以太网与交换机；
  * 6.5 \*MPLS\* 高速转发。

## 6.2  差错检测与纠正

（PPT 6.2 对应页逐页翻译＋讲解）

---

### 6.2.1  差错为何出现？

* 有线链路的热噪声、无线链路的多径与干扰，都会使 0/1 翻转。误码率虽只有 10-6 ～ 10-10，但千兆链路每秒就传亿级比特，必须防护。
* “差错控制”分两步：
  1. **\*错误检验方法\*** ——发现帧损坏；
  2. **\*错误纠正机制\*** ——要么本地修复，要么让上一层重传。

---

### 6.2.2  最简单：奇偶校验 (Parity)


| 方案            | 步骤                                              | 检测能力                           |
| --------------- | ------------------------------------------------- | ---------------------------------- |
| 单比特奇/偶校验 | 在每 7 bit 数据后添 1 bit，使 1 的个数成为奇/偶数 | 只能查出奇数个翻转                 |
| 二维奇偶        | 先按行再按列加校验 bit                            | 检测 2 bit 错、定位并纠正 1 bit 错 |

硬件实现只需异或门；今天常用在 UART、RAM 条。

---

### 6.2.3  Internet Checksum

* 把数据按 16 bit 分段做 **一补和**，末尾再取一补；UDP/TCP 头部都用它。
* 优点：软件容易；缺点：对某些位翻转（等值补偿）无感，检测率不及 CRC。

---

### 6.2.4  **\*CRC\*（循环冗余检验）** — 主考点

1. ![1748433408204](images/5.链路层/1748433408204.png)**

---

### 6.2.5  **\*错误纠正机制\*** — 检测之后怎么办？


| 思路             | 链路层常见做法                                   | 代表协议                                  |
| ---------------- | ------------------------------------------------ | ----------------------------------------- |
| **ARQ 重传**   | 发现错即丢帧，并请求上层或对端重发；简单但需反馈 | PPP (Stop-&-Wait)、802.11 ACK             |
| **FEC 前向纠错** | 发送端添冗余，接收端可自行修复一定位错           | 光纤 FEC (Reed–Solomon)、卫星 Turbo/LDPC |
| **混合 HARQ**    | 先尝试 FEC，若仍失败再 ARQ 重传                  | LTE 无线链路                              |

链路层大多采用 “CRC + ARQ”；广域长时延或高 BER 信道（卫星、光传送网）才会上 FEC。

---

### 6.2.6  对比与选型小结


| 方法             | 冗余开销      | 硬件复杂度 | 检测/纠正特性                   |
| ---------------- | ------------- | ---------- | ------------------------------- |
| 奇偶             | 1 bit / 字节  | 极低       | 检测偶/奇数错，纠 1 bit（二维） |
| Checksum         | 16 bit / 报文 | 低         | 中等检测率，无法纠错            |
| **\*CRC\***      | r bit / 帧    | 中         | 高检测率，常与 ARQ 搭配         |
| FEC (RS/Hamming) | 成倍冗余      | 高         | 可直接纠正，适合高 BER          |

* **考场记忆**：**“MAC 帧用 CRC-32，PPP/Wi-Fi 用 CRC-16/32”**；CRC 能检测突发差错，真正纠错一般靠重传。
* 设计题若要求“给定 `G(x)=1011` 计算 CRC”→ 按 PPT 例子落笔即可。

---


## 6.3  Multiple-Access Protocols —— 当多台节点共用同一条广播信道

（翻译自 PPT 6.3，并仅在你的考点 **TDMA / CDMA / CSMA** 处加 \*\*\*）

---

### 6.3.1  问题背景

* **广播信道**：一根同轴电缆、一段 Wi-Fi 频道、卫星上行链路……任何时刻只能有 **一个** 发射端真正占用介质。
* **冲突**：若两节点同时发，信号相互叠加就毁帧，必须重发——效率大降。
* 目标：设计 **介质接入协议 (MAC protocol)**，让所有节点公平、高效地“轮流说话”。

---

### 6.3.2  三大类 MAC 协议总览


| 类别         | 核心思路                       | 代表                                  | 适用场景         |
| ------------ | ------------------------------ | ------------------------------------- | ---------------- |
| **信道划分** | 先把“资源大块”切细分给每人   | **\*TDMA\***、FDMA、**\*CDMA\***      | 电话网、蜂窝上行 |
| **随机接入** | 任何时刻都可尝试发，冲突后重来 | **\*CSMA\***、ALOHA、CSMA/CD、CSMA/CA | 以太网、Wi-Fi    |
| **轮流制**   | 明确“谁先谁后”令牌/轮询      | Token Ring, Polling                   | 低速工业总线     |

---

## 6.3.A  *TDMA*（Time-Division Multiple Access）


| 要点      | 说明                                                        |
| --------- | ----------------------------------------------------------- |
| **核心**  | 把总带宽按“时间片”分成 N 个等长时隙；节点 i 只在隙 i 发。 |
| 同步      | 所有节点共享时钟分界线；卫星、蜂窝基站负责下发同步信标。    |
| 延迟/效率 | **无冲突**，空闲时隙会浪费；若流量不均衡，效率低。          |
| 公式      | 信道利用率 = 在用隙 / 总隙（高峰满载时可达 100 %）          |
| 课本示例  | 4 节点、125 µs/隙，帧长 1 ms → 每节点得 2 Mbps 固定带宽。 |

---

## 6.3.B  *CDMA*（Code-Division Multiple Access）


| 要点     | 说明                                                                                               |
| -------- | -------------------------------------------------------------------------------------------------- |
| **核心** | 每节点与众不同的“扩频码” ⟶ 同频同时间也能并发；接收端用相关运算“解码自己”。                   |
| 码字     | 正交或伪随机序列（长度 m）；比特**扩频**为 m chip → 带宽放大 m 倍。                               |
| 抗干扰   | 码序列互相关接近 0 → 天然抗窃听、抗窄带干扰；军用、蜂窝上行曾广用。                               |
| 帧同步   | 需精确码相位；复杂度高于 TDMA/FDMA。                                                               |
| 课堂直观 | 把教室喻作广播介质：每人说相同音量英语句子但配上专属节拍，老师只听“大鼓点”节拍就能提取一人信息。 |

> PPT 以 4-chip Walsh 码举例展示“发送 1101、收到经多址叠加后如何相关分离”。

---

## 6.3.C  *CSMA*（Carrier-Sense Multiple Access）


| 版本                     | 规则                                                   | 目的               |
| ------------------------ | ------------------------------------------------------ | ------------------ |
| **1. 非持有 CSMA**       | 若检测到信道忙 → 随机退避再听                         | 减少碰撞再复发     |
| **2. 1-持有 CSMA**       | 信道忙就持续监听，占闲立即发                           | 稍增效率           |
| **3. CSMA/CD**（以太网） | 边发边监听，发现碰撞立即发*jam*& 二进制指数退避        | 有线半双工冲突检测 |
| **4. CSMA/CA**（Wi-Fi）  | 无法检测碰撞 → 发送前随机倒计时；RTS/CTS 解决隐藏节点 | 无线半双工避免冲突 |

**效率近似公式（有线 1-持 CSMA）**

效率≈11+5×tpropttrans\\text{效率} \\approx \\frac{1}{1 + 5 \\times \\frac{t\_\\text{prop}}{t\_\\text{trans}}}• tpropt\_\\text{prop}: 信号在总线端到端传播时延 • ttranst\_\\text{trans}: 发送一帧所需时间
→ 推论：短线缆 / 大帧长时效率接近 1，长线缆 / 小帧则效率显著下降。

---

### 6.3.3  类间优缺点评价


| 指标       | *TDMA*           | *CDMA*                   | *CSMA*       |
| ---------- | ---------------- | ------------------------ | ------------ |
| 冲突       | 无               | “码域”分离，逻辑无冲突 | 有，需退避   |
| 空闲浪费   | 有（若隙无人发） | 无                       | 无           |
| 硬件复杂度 | 中               | 高（扩频/解扩）          | 低           |
| 同步需求   | 高               | 最高                     | 低           |
| 高峰公平   | 天然平等         | 视功率控制               | 退避可能饿死 |

---

### 6.3.4  典型应用对号入座

* **蜂窝上行 (3 G)**：曾以 *CDMA*（IS-95, W-CDMA）为主；4 G 之后统一 OFDMA。
* **卫星 TDMA**：每地面站固定时隙避免长 RTT 引致冲突。
* **有线 10BASE-T Hub 网络**：半双工 + *CSMA/CD*。
* **现代交换式以太网**：点对点全双工——**不再需要 CSMA**。
* **Wi-Fi**：依旧共享空口 ⇒ *CSMA/CA* + ACK。

---

### 6.3.5  小结（星号回顾）

* **\*TDMA\***：按时隙静态分配，零碰撞 → 频道利用率取决于业务均衡度。
* **\*CDMA\***：用正交 PN 码把“用户”搬到码域，理论“同时同频”；硬件与功控更复杂。
* **\*CSMA\***：先听后发，现实 LAN/WLAN 通用随机接入；有线可冲突检测 (CD)，无线靠冲突避免 (CA)。


若需看 CSMA/CD 二进制退避过程示意，或动手计算 TDMA 带宽分配，随时告诉我！

## 6.4  Link-Layer Addressing, ARP, Ethernet, Switches & VLANs

（对应 *Chapter-6 The Link Layer and LANs* PPT 6.4 页）

---

### 6.4.1  MAC 地址——局域网里的“身份证”

* 48 bit（6 byte）十六进制写法，全球唯一，由 IEEE 分配给网卡厂家。
* 只在 **本地链路** 生效；跨越路由器后就会换成下一跳链路上的 MAC。
* 目的：让链路层硬件能够在 **微秒级** 用硬件表（或学习表）完成帧转发。

---

### 6.4.2  **\*ARP (地址解析协议)\***


| 要点                                                    | 说明                                                                                                                                                            |
| ------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **\*作用\***                                            | 在同一**LAN**内把 “目的**IP**” → “目的**MAC**” 映射出来                                                                                                    |
| **\*工作原理\***                                        | “问卷广播” → “单播回答”主机 A 发送**ARP Request**：目的 MAC = ff:ff:ff:ff:ff:ff，问“谁是 10.0.0.9？”；持有该 IP 的主机 B 回**ARP Reply**告知自己的 MAC。 |
| **\*工作过程\***                                        | ① 查询本机 ARP 缓存（一般 20 min 软状态）                                                                                                                      |
| ② 若无→广播请求                                       |                                                                                                                                                                 |
| ③ 收到匹配回复→缓存，并把 IP 数据报封装入以太网帧发出 |                                                                                                                                                                 |
| **\*何时用 MAC 地址\***                                 | **仅当目标在同一子网/LAN**时需要“解” MAC；若目标跨网段，主机把帧交给**默认网关**（其 MAC 经 ARP 获得），由路由器继续转发。                                    |

---

### 6.4.3  **\*LAN & VLAN\*** —— 概念、目的、优点


| 项目         | 定义                                                                    | **\*目的/优点\***                                                                                                                                   |
| ------------ | ----------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------- |
| **\*LAN\***  | 物理意义上的局域网：一组设备共享同一二层广播域                          | ① 带宽高、延迟低；② 管理范围小；③ 设备靠**交换机**自学习即可互联                                                                                 |
| **\*VLAN\*** | 在同一物理交换机/骨干上，按**VLAN ID**把端口/用户逻辑分组，互相隔离广播 | ①**隔离**：访客网与内网分开；②**广播域缩小**，减轻 ARP 风暴；③**灵活迁移**：主机移动端口，只要 VLAN ID 不变，网段保持；④**安全/多租户**场景常用 |

* 802.1Q 在以太网帧中插入 4 B Tag (VLAN ID + 优先级)。
* 多交换机间用 **Trunk 端口**（tagged 帧）携带多 VLAN。

---

### 6.4.4  以太网 & 交换机基础

* 帧格式：前导码 7 B＋SFD 1 B｜Dst MAC｜Src MAC｜Type｜Payload (≤1500 B)｜CRC 4 B。
* 现代交换机工作 **全双工**，每端口是一个独立冲突域—因此 **无需 CSMA/CD**。
* **自学习**算法：第一次看到 Src MAC=AA:.. 来自端口 3 → 在转发表记“AA 在 3”；转发时按 Dst MAC 索引表得目标端口。表目默认 5 min aging。

---

### 6.4.5  **\*路由器还是交换机？什么时候用谁？\***


| 场景                                        | 推荐设备                          | 原因                                      |
| ------------------------------------------- | --------------------------------- | ----------------------------------------- |
| 同一**VLAN/LAN**内二层转发                  | **\*交换机\***                    | 速度快（ASIC 线速）、成本低、无需 IP 分段 |
| 不同**子网 / VLAN**互通                     | **\*路由器** *或*三层交换机\*\*\* | 需要查看 IP 首部并重新选路；可做 NAT、ACL |
| 大二层环网易环路                            | **路由器**（或启用 STP/RSTP）     | 三层分段天然无广播风暴；二层需生成树防环  |
| 需策略路由、QoS、VPN                        | 路由器                            | 更丰富的控制平面、报文改写功能            |
| 纯局域高速东-西流量（数据中心 Top-of-Rack） | 交换机                            | 延迟纳秒级、端口密度高                    |

> **口诀**
>
> * **“同网段靠交换机，跨网段找路由”**
> * 若要进/出互联网 ➟ 必经路由器（做 NAT、BGP …）。

---

### 6.4.6  小结（星号回顾）

1. **\*ARP：作用、原理、过程、何时需 MAC\***
2. **\*LAN / VLAN：概念、目的、优点\***
3. **\*以太网中交换机 vs 路由器的取舍\***

掌握这三块即可回答链路层常考的选择/简答：

* “ARP 流程图” - “VLAN 带来的三大好处” - “为什么跨子网要用路由器而不是交换机”等。
  若想看抓包示例 (ARP 帧) 或练习 VLAN Tag 计算，随时告诉我！




### 6.5 MPLS —— 三段话速记（★考点：指导数据报文并实现高速转发）

1. **一张“快递单”**
   MPLS 在 IP 头和链路层头之间插入 **20 bit Label**。入口 LER push，沿途 LSR swap，出口 pop——查表键永远是〈入端口, Label〉，**定长**、**硬件流水线**，比最长前缀匹配快得多。
2. **流量工程 & VPN**
   控制器/路由器可显式把不同业务贴上不同 Label，走指定 LSP；遇故障仅需几毫秒换 Label 就能绕路。再叠一层 Label 就能把多家客户“隔离”跑在同一骨干。
3. **“混血”优势**
   上承任何三层协议（“Multi-Protocol”），下保以太硬件速度：**高速转发 + 策略弹性**——这正是卷面常问的 MPLS 精髓。

---

## 6.6 Data-Center Networks（数据中心网络）


| 关键词          | 核心内容                                        | 典型做法/技术                 |
| --------------- | ----------------------------------------------- | ----------------------------- |
| **流量模型**    | 东-西通信占比 ≈ 90 %                           | 多 ToR 间大规模并发           |
| **拓扑**        | 多级**Clos / Fat-Tree / Spine-Leaf**，每层 ECMP | 上百条等价 10 G/40 G 链路并行 |
| **负载均衡**    | L4/L7 SLB, Anycast, DNS RR                      | 解决“热机柜”                |
| **无损/低延迟** | PFC, ECN, DCTCP, RDMA-over-Converged-Ethernet   | 微秒级尾延迟                  |
| **虚拟网络**    | VXLAN, NVGRE, Geneve 覆盖在 IP/MPLS 之上        | 租户隔离 + 大二层             |
| **控制方式**    | 大多采用 SDN：集中控制器计算 ECMP / SR-MPLS     | 快速故障收敛、流量工程        |

**记忆点**

* “**Fat-Tree + ECMP** 提供全-bisection 带宽”
* “**Spine-Leaf 两跳** → 时延可预测、横向扩展”
* “**Overlay VPN** 让上万个租户看见各自的二层”

---

## 6.7 A Day in the Life of a Web Request（一次网页请求的全链路旅程）

> PPT 用时间线串起整个协议栈，这里按发生顺序快速过一遍。

1. **启动阶段**
   * **DHCP** 发现 + Offer → 获得本机 IP、子网掩码、默认网关。
   * 可选 **NAT** 配置：私网地址映射到公网地址:端口。
2. **解析域名**
   * 浏览器查本机 DNS 缓存 → 若无，向递归解析器发 **UDP 53** 查询；缓存 TTL 几分钟到一小时。
3. **TCP 握手 & TLS**
   * 3-way handshake（SYN, SYN-ACK, ACK），若使用 HTTPS 立即进入 TLS ClientHello → ServerHello 授权、密钥协商。
4. **HTTP**
   * HTTP/2 或 HTTP/3 请求：头压缩 + 多路复用；服务器返回 HTML/CSS/JS。
5. **链路-层幕后**
   * 每个新目的地先走 **ARP** 找到网关 MAC；帧进入交换式以太网（全双工，无 CSMA）→ 出口路由器。
   * 若骨干部署 **MPLS / 数据中心 Fabric**，数据报被打 Label、在 Clos 网络里做 ECMP。
6. **回程**
   * 服务器到客户端反向路径通常因 BGP “热土豆”择最近出口。TTL 递减，若为诊断可看到 **ICMP 11/0**。
7. **收尾**
   * 浏览器渲染完成后，TCP 进入 TIME\_WAIT；DNS、ARP 项目最终根据超时清理。

**思维导图式记忆**

```
DHCP → ARP → TCP 3WH / TLS → HTTP → (MPLS / ECMP) → ICMP 可视化 → FIN
```

整条链路把你在本章学到的 **MAC-ARP-交换机-VLAN-MPLS** 与前几章的 **TCP, DNS, HTTP, SDN** 全部串联，可用作期末“综合论述”模板。

---

### 一页速览：本章所有★考点


| 章节 | 星号考点                          |
| ---- | --------------------------------- |
| 6.2  | CRC、差错检测/纠正方法            |
| 6.3  | TDMA/CDMA、CSMA                   |
| 6.4  | ARP；LAN & VLAN；交换机 vs 路由器 |
| 6.5  | MPLS：数据报指导 & 高速转发       |

> 6.6 与 6.7 主要用于综合理解，通常出 “简述数据中心拓扑优势” 或 “按时间线描述一次网页请求” 类型题。掌握上表即可覆盖必考点。

如需练习题、Wireshark 抓包或画 Clos-Fabric 拓扑示意，请告诉我！
